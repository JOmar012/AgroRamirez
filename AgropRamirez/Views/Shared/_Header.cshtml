@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims

@* Nombre en el navbar *@
@{
    var nombreCompleto = User.Identity?.Name ?? "";
    var soloNombre = string.Join(" ", nombreCompleto.Split(" ").Take(2));// esto te da "Juan" de "Juan Pérez"
}

@{
    // Helper para marcar el link activo
    var currentController = (ViewContext.RouteData.Values["controller"]?.ToString() ?? "");
    var currentAction = (ViewContext.RouteData.Values["action"]?.ToString() ?? "");
    Func<string, string, string> active = (ctrl, act) =>
        string.Equals(currentController, ctrl, StringComparison.OrdinalIgnoreCase)
        && string.Equals(currentAction, act, StringComparison.OrdinalIgnoreCase)
        ? "active" : "";
}

<!-- Topbar Start -->
<div class="container-fluid bg-dark text-light px-0 py-2">
    <div class="row gx-0 d-none d-lg-flex">
        <div class="col-lg-7 px-5 text-start">
            <div class="h-100 d-inline-flex align-items-center me-4">
                <span class="fa fa-phone-alt me-2"></span>
                <span>+012 345 6789</span>
            </div>
            <div class="h-100 d-inline-flex align-items-center">
                <span class="far fa-envelope me-2"></span>
                <span>info@example.com</span>
            </div>
        </div>
        <div class="col-lg-5 px-5 text-end">
            <div class="h-100 d-inline-flex align-items-center mx-n2">
                <span>Follow Us:</span>
                <a class="btn btn-link text-light" href=""><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-link text-light" href=""><i class="fab fa-twitter"></i></a>
                <a class="btn btn-link text-light" href=""><i class="fab fa-linkedin-in"></i></a>
                <a class="btn btn-link text-light" href=""><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>
</div>
<!-- Topbar End -->
<!-- Navbar Start -->
<nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0">
    <a asp-controller="Home" asp-action="Index" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
        <!-- Logo -->
        <img src="~/img/LOGO1.png" alt="Logo S.A.R" style="height:60px; width:auto; margin-right:10px;" />

        <!-- Nombre de la empresa -->
        <div class="d-flex flex-column" style="font-style: italic; margin-top:-3px; margin-bottom:-3px; line-height:1.1;">
            <span class="fw-bold fs-3" style="margin-bottom:2px;">S.A.R</span>
            <span style="font-size: 0.6rem; line-height:1;">Servicios Agropecuarios</span>
            <span style="font-size: 0.6rem; line-height:1;">Ramírez EIRL</span>
        </div>
    </a>

    <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <div class="navbar-nav ms-auto p-4 p-lg-0">
            <a asp-controller="Home" asp-action="Index" class="nav-item nav-link @active("Home", "Index")">Inicio</a>
            <a asp-controller="Home" asp-action="Nosotros" class="nav-item nav-link @active("Home", "Nosotros")">Nosotros</a>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle @active("Home", "Service")" href="#" id="navbarDropdownServicios"
                   role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-gear-fill"></i> Servicios
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdownServicios">
                    <li>
                        <a asp-controller="Productoes" asp-action="Index" class="dropdown-item">
                            <i class="bi bi-box"></i> Productos
                        </a>
                    </li>
                    <li>
                        <a asp-controller="Promocions" asp-action="Index" class="dropdown-item">
                            <i class="bi bi-gift-fill"></i> Promociones
                        </a>
                    </li>
                </ul>
            </li>
            @* <a asp-controller="Home" asp-action="" class="nav-item nav-link @active("Home", "Project")">Projectos</a> *@
            <a asp-controller="Home" asp-action="Contacto" class="nav-item nav-link @active("Home", "Contacto")">Contacto</a>

            @* @if (User.Identity.IsAuthenticated && User.IsInRole("Administrador"))
            { *@
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Gestionar</a>
                    <div class="dropdown-menu bg-light m-0">

                        <a asp-controller="Usuarios" asp-action="Index" class="dropdown-item">Usuarios</a>
                        <a asp-controller="Categorias" asp-action="Index" class="dropdown-item">Categorias</a>
                        <a asp-controller="Productoes" asp-action="Index" class="dropdown-item">Productos</a>
                        <a asp-controller="Promocions" asp-action="Index" class="dropdown-item">Promociones</a>
                        <a asp-controller="Carritoes" asp-action="Index" class="dropdown-item">Carrito C</a>
                        <a asp-controller="CarritoDetalles" asp-action="Index" class="dropdown-item">Det Carrito</a>
                        <a asp-controller="Pedidoes" asp-action="Index" class="dropdown-item">Pedidos</a>
                        <a asp-controller="PedidoDetalles" asp-action="Index" class="dropdown-item">Pedido det</a>
                        <a asp-controller="Pagoes" asp-action="Index" class="dropdown-item">Pagos</a>
                        <a asp-controller="Notificacions" asp-action="Index" class="dropdown-item">Notificación</a>
                        <a asp-controller="Cotizacions" asp-action="Index" class="dropdown-item">Cotización</a>
                        <a asp-controller="CotizacionDetalles" asp-action="Index" class="dropdown-item">CotizaDetalle</a>

                        @* <a asp-controller="Home" asp-action="Feature" class="dropdown-item">Features</a>
                    <a asp-controller="Home" asp-action="Quote" class="dropdown-item">Free Quote</a>
                    <a asp-controller="Home" asp-action="Team" class="dropdown-item">Our Team</a>
                    <a asp-controller="Home" asp-action="Testimonial" class="dropdown-item">Testimonial</a>
                    <a asp-controller="Home" asp-action="Error404" class="dropdown-item">404 Page</a> *@
                    </div>
                </div>

            @* } *@
            
            @* Carrito *@
            <li class="nav-item">
                <a class="nav-link position-relative" asp-controller="Carritoes" asp-action="MiCarrito">
                    <i class="bi bi-cart4 fs-5"></i>
                    <span id="cartCount"
                          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark"
                          style="display:none;">
                        0
                    </span>
                </a>
            </li>
           
        </div>

      @*login *@

        @if (User.Identity.IsAuthenticated)
        {
            <div class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle text-capitalize" data-bs-toggle="dropdown">
                    <i class="bi bi-person-circle"></i> @soloNombre
                </a>
                <div class="dropdown-menu dropdown-menu-end bg-light m-0">
                    <a asp-controller="Cuenta" asp-action="Logout" class="dropdown-item">
                        <i class="bi bi-box-arrow-right"></i> Cerrar sesión
                    </a>
                </div>
            </div>
        }
        else
        {
            <a class="nav-link" asp-controller="Cuenta" asp-action="Login">
                <i class="bi bi-box-arrow-in-right"></i> Iniciar sesión
            </a>
        }

    </div>
</nav>
<!-- Navbar End -->